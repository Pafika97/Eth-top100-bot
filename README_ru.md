# Бот Telegram: Топ‑100 кошельков ETH + пометка изменений >50%

Этот бот по команде показывает в чате Telegram список из 100 адресов c наибольшим балансом ETH и помечает те адреса, у которых баланс изменился более чем на **50%** по сравнению с предыдущим запросом.

## Источники данных (провайдеры)

1. **OKLink API** (если задан `OKLINK_API_KEY`) — до топ‑300 держателей с обновлением ~каждый час. Надёжный агрегатор ончейн‑данных.  
2. **Etherscan (скрейп веб‑страницы)** — резервный источник: парсинг таблицы «Top Accounts by ETH Balance».

> Примечание: мы используем *несколько источников* и автоматический фолбэк, чтобы всегда получить актуальные данные. Вы можете отключить любой из провайдеров, не указывая токен/переменные для него.

## Быстрый старт

1. **Установите зависимости** (Python 3.10+):
   ```bash
   python -m venv .venv
   . .venv/bin/activate  # Windows: .venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **Настройте переменные окружения**. Создайте файл `.env` на основе `.env.example` и заполните:
   - `TELEGRAM_BOT_TOKEN` — токен вашего Telegram‑бота от @BotFather.
   - (опц.) `OKLINK_API_KEY` — ключ OKLink (https://www.oklink.com/docs/en/).
   - (опц.) `ETHERSCAN_BASE` — домен Etherscan (оставьте по умолчанию).

3. **Запустите бота**:
   ```bash
   python bot.py
   ```

4. В чате с ботом используйте команду:
   - `/top100` — показать топ‑100 и отметить кошельки с изменением >50% (значок ⚠️).

## Как помечаются изменения >50%

- Бот хранит последнюю выборку в `data/last_top100_eth.json`.
- При следующем `/top100` он сравнит текущие балансы с предыдущими и посчитает `((текущий − предыдущий)/предыдущий)·100%`.
- Если модуль изменения ≥ 50% — адрес помечается ⚠️.
- Для адресов, которых не было ранее, пишется пометка `(new)` или `(new balance)`.

## Формат вывода

Каждая строка:
```
<rank>. <адрес> — <тег, если есть>
    <баланс ETH> • src:<источник> (<изменение %>) [⚠️ если ≥50%]
```

Список разбивается на несколько сообщений, если он не помещается в один пост Telegram.

## Заметки по надёжности и этике источников

- **OKLink API** — официальный, с ключом, квоты зависят от тарифа.  
- **Etherscan** — используется лишь открытая таблица «Top Accounts…». Так как страницы публичны и содержат «Download Page Data», умеренный парсинг допустим. Частоту запросов лучше ограничить 1–2/мин., чтобы избегать блокировок.

Вы можете легко заменить/добавить провайдер (например, альтернативный эксплорер) — см. папку `providers/`.

## Частые вопросы

**Можно ли запускать на бесплатном хостинге?**  
Да, боту нужен только исходящий HTTP и Python 3.10+.

**Нужно ли оплачивать платные API?**  
Нет, по умолчанию бот работает со скрейпингом Etherscan. Однако для большей стабильности рекомендую завести бесплатный ключ OKLink.

**Как изменить порог пометки (не 50%)?**  
Откройте `storage.py` и расширьте логику в `compute_changes`, либо добавьте переменную окружения и параметризуйте.

---

© Ваш частный бот для мониторинга топ‑кошельков ETH.
